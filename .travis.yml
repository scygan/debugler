language: cpp

branches:
  only:
  - master

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-4.7
    - g++-4.7
    - libxxf86vm-dev
    - python-lxml
    - x11proto-gl-dev
    - libelf-dev

compiler:
    - gcc

env:
    - VERSION=0.1.$TRAVIS_BUILD_NUMBER

before_script:
    - TERM=dumb curl -L http://dl.google.com/android/ndk/android-ndk-r10e-linux-x86.bin -O android-ndk-r10e-linux-x86_64.bin
    - chmod u+x android-ndk-r10e-linux-x86_64.bin
    - ./android-ndk-r10e-linux-x86_64.bin > /dev/null

script: cd tools && python set_version.py 0.1.$TRAVIS_JOB_NUMBER && cd .. && CXX=g++-4.7
  CC=gcc-4.7 python build.py 64


after_success:
  # CREATE GIT TAG
  - git config --global user.email "builds@travis-ci.com"
  - git config --global user.name "Travis CI"
  - export GIT_TAG=travis-$VERSION
  - git tag $GIT_TAG -a -m "Generated tag from TravisCI build $VERSION"
  - if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then git push --quiet https://$GITHUBKEY@github.com/$TRAVIS_REPO_SLUG $GIT_TAG; fi

deploy:
  provider: releases
  api_key:
    secure: TQLKHXfgTXuqFOPrGZlRZm610uxzUmm1dKwUhOnimzWdM5g4UXWdQbTlXlzq4kUR6FLWkYRnXEyx939RRh/iCXhQJJ0OxrUymDRIJ146JPiSBjuFQO4HxxS7JmwgjnT8XzBkdWLNivWR+nwGrHlF0t/qPcoMpkHcnjVnl/d4zmk=
  file: build/64/Release/debugler-$VERSION-Linux.deb
  on:
    repo: $TRAVIS_REPO_SLUG
    branch: master

