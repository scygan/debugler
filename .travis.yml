language: cpp

branches:
  only:
  - master

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-4.7
    - g++-4.7
    - libxxf86vm-dev
    - python-lxml
    - x11proto-gl-dev
    - libelf-dev

compiler:
    - gcc

env:
  global:
    - VERSION=0.1.$TRAVIS_BUILD_NUMBER
    - ANDROID_NDK="$(pwd)/android-ndk-r14"
    
before_install:
    - wget --timeout=120 https://dl.google.com/android/repository/android-ndk-r14-linux-x86_64.zip -O ndk.zip
    - unzip ndk.zip 1> /dev/null

script: cd tools && python set_version.py 0.1.$TRAVIS_JOB_NUMBER && cd .. && CXX=g++-4.7
  CC=gcc-4.7 python build.py 64-dist

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: TQLKHXfgTXuqFOPrGZlRZm610uxzUmm1dKwUhOnimzWdM5g4UXWdQbTlXlzq4kUR6FLWkYRnXEyx939RRh/iCXhQJJ0OxrUymDRIJ146JPiSBjuFQO4HxxS7JmwgjnT8XzBkdWLNivWR+nwGrHlF0t/qPcoMpkHcnjVnl/d4zmk=
  file: build/64/Release/debugler-$VERSION-Linux-withAndroid.deb
  on:
    repo: $TRAVIS_REPO_SLUG
    branch: master

